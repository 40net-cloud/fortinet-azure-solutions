{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "basics": {
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "resourceTypes": [
      "microsoft.resources/resourcegroups"
    ],
    "basics": [
      {
        "name": "adminUsername",
        "type": "Microsoft.Common.TextBox",
        "label": "FortiAnalyzer administrative username",
        "defaultValue": "",
        "toolTip": "Username for the FortiAnalyzer virtual appliance. Most not be root, administrator or admin",
        "constraints": {
          "required": true,
          "validations": [
            {
              "regex": "^[a-z0-9A-Z]{1,30}$",
              "message": "Only alphanumeric characters are allowed, and the value must be 1-30 characters long"
            },
            {
              "isValid": "[not(contains(toLower(basics('adminUsername')),'root'))]",
              "message": "Usernames must not include reserved words"
            },
            {
              "isValid": "[not(contains(toLower(basics('adminUsername')),'admin'))]",
              "message": "Usernames must not include reserved words"
            }
          ]
        },
        "visible": true
      },
      {
        "name": "adminPassword",
        "type": "Microsoft.Common.PasswordBox",
        "label": {
          "password": "FortiAnalyzer password",
          "confirmPassword": "Confirm password"
        },
        "toolTip": "Password for the Virtual Machine",
        "constraints": {
          "required": true,
          "regex": "^(?:(?=.*[a-z])(?:(?=.*[A-Z])(?=.*[\\d\\W])|(?=.*\\W)(?=.*\\d))|(?=.*\\W)(?=.*[A-Z])(?=.*\\d)).{12,}$",
          "validationMessage": "The password must be between 12 characters or longer, and contain characters from at least 3 of the following groups: uppercase characters, lowercase characters, numbers, and special characters excluding '\\' or '-'."
        },
        "options": {
          "hideConfirmation": false
        },
        "visible": true
      },
      {
        "name": "namePrefix",
        "type": "Microsoft.Common.TextBox",
        "label": "FortiAnalyzer Name Prefix",
        "defaultValue": "",
        "toolTip": "Naming prefix for all deployed resources",
        "constraints": {
          "required": true,
          "regex": "^[A-Za-z0-9-]{1,15}$",
          "validationMessage": "Only alphanumeric characters are allowed, and the value must be 1 to 15 characters."
        },
        "visible": true
      },
      {
        "name": "imageSku",
        "type": "Microsoft.Common.DropDown",
        "label": "FortiAnalyzer Image SKU",
        "defaultValue": "Bring Your Own License",
        "toolTip": "BYOL license model (where license is purchased separately)",
        "constraints": {
          "required": false,
          "allowedValues": [
            {
              "label": "Bring Your Own License",
              "value": "fortinet-fortianalyzer"
            }
          ]
        },
        "visible": true
      },
      {
        "name": "imageVersion",
        "type": "Microsoft.Common.DropDown",
        "label": "FortiAnalyzer Image Version",
        "defaultValue": "7.4.7",
        "toolTip": "Only 6.x has the A/P HA feature currently",
        "constraints": {
          "required": false,
          "allowedValues": [
            {
              "label": "latest",
              "value": "latest"
            },
            {
              "label": "7.6.5",
              "value": "7.6.5"
            },
            {
              "label": "7.6.4",
              "value": "7.6.4"
            },
            {
              "label": "7.6.3",
              "value": "7.6.3"
            },
            {
              "label": "7.6.2",
              "value": "7.6.2"
            },
            {
              "label": "7.6.1",
              "value": "7.6.1"
            },
            {
              "label": "7.6.0",
              "value": "7.6.0"
            },
            {
              "label": "7.4.8",
              "value": "7.4.8"
            },
            {
              "label": "7.4.7",
              "value": "7.4.7"
            },
            {
              "label": "7.4.6",
              "value": "7.4.6"
            },
            {
              "label": "7.4.5",
              "value": "7.4.5"
            },
            {
              "label": "7.4.4",
              "value": "7.4.4"
            },
            {
              "label": "7.4.3",
              "value": "7.4.3"
            },
            {
              "label": "7.4.2",
              "value": "7.4.2"
            },
            {
              "label": "7.4.1",
              "value": "7.4.1"
            },
            {
              "label": "7.4.0",
              "value": "7.4.0"
            },
            {
              "label": "7.2.9",
              "value": "7.2.9"
            },
            {
              "label": "7.2.8",
              "value": "7.2.8"
            },
            {
              "label": "7.2.7",
              "value": "7.2.7"
            },
            {
              "label": "7.2.6",
              "value": "7.2.6"
            },
            {
              "label": "7.2.5",
              "value": "7.2.5"
            },
            {
              "label": "7.2.4",
              "value": "7.2.4"
            },
            {
              "label": "7.2.3",
              "value": "7.2.3"
            },
            {
              "label": "7.2.2",
              "value": "7.2.2"
            },
            {
              "label": "7.2.11",
              "value": "7.2.11"
            },
            {
              "label": "7.2.10",
              "value": "7.2.10"
            },
            {
              "label": "7.2.1",
              "value": "7.2.1"
            },
            {
              "label": "7.2.0",
              "value": "7.2.0"
            },
            {
              "label": "7.0.9",
              "value": "7.0.9"
            },
            {
              "label": "7.0.7",
              "value": "7.0.7"
            },
            {
              "label": "7.0.6",
              "value": "7.0.6"
            },
            {
              "label": "7.0.5",
              "value": "7.0.5"
            },
            {
              "label": "7.0.4",
              "value": "7.0.4"
            },
            {
              "label": "7.0.3",
              "value": "7.0.3"
            },
            {
              "label": "7.0.2",
              "value": "7.0.2"
            },
            {
              "label": "7.0.14",
              "value": "7.0.14"
            },
            {
              "label": "7.0.13",
              "value": "7.0.13"
            },
            {
              "label": "7.0.12",
              "value": "7.0.12"
            },
            {
              "label": "7.0.11",
              "value": "7.0.11"
            },
            {
              "label": "7.0.10",
              "value": "7.0.10"
            },
            {
              "label": "7.0.1",
              "value": "7.0.1"
            },
            {
              "label": "7.0.0",
              "value": "7.0.0"
            },
            {
              "label": "6.4.9",
              "value": "6.4.9"
            },
            {
              "label": "6.4.8",
              "value": "6.4.8"
            },
            {
              "label": "6.4.7",
              "value": "6.4.7"
            },
            {
              "label": "6.4.6",
              "value": "6.4.6"
            },
            {
              "label": "6.4.5",
              "value": "6.4.5"
            },
            {
              "label": "6.4.2",
              "value": "6.4.2"
            },
            {
              "label": "6.4.15",
              "value": "6.4.15"
            },
            {
              "label": "6.4.14",
              "value": "6.4.14"
            },
            {
              "label": "6.4.13",
              "value": "6.4.13"
            },
            {
              "label": "6.4.12",
              "value": "6.4.12"
            },
            {
              "label": "6.4.11",
              "value": "6.4.11"
            },
            {
              "label": "6.4.10",
              "value": "6.4.10"
            },
            {
              "label": "6.4.1",
              "value": "6.4.1"
            },
            {
              "label": "6.4.0",
              "value": "6.4.0"
            },
            {
              "label": "6.2.5",
              "value": "6.2.5"
            },
            {
              "label": "6.2.3",
              "value": "6.2.3"
            },
            {
              "label": "6.2.2",
              "value": "6.2.2"
            },
            {
              "label": "6.2.1",
              "value": "6.2.1"
            },
            {
              "label": "6.2.0",
              "value": "6.2.0"
            }
          ]
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "instance",
        "label": "Instance",
        "subLabel": {
          "preValidation": "Select instance type",
          "postValidation": "Done"
        },
        "elements": [
          {
            "name": "instancetype",
            "type": "Microsoft.Common.Section",
            "label": "Instance Type",
            "elements": [
              {
                "name": "instancetypeinfo",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "For this FortiAnalyzer deployment, it is recommended to use general purpose virtual machines. A selection of supported instances sizes is listed in our documentation.",
                  "link": {
                    "label": "Learn more",
                    "uri": "https://docs.fortinet.com/document/fortianalyzer-public-cloud/7.2.0/azure-administration-guide/351055"
                  }
                }
              },
              {
                "name": "selection",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Size",
                "toolTip": "Select the instance size of your FortiAnalyzer VM solution. Minimum 4 NICs are required.",
                "recommendedSizes": [
                  "Standard_DS4_v2",
                  "Standard_DS5_v2",
                  "Standard_D4_v3",
                  "Standard_D8_v3",
                  "Standard_D16_v3",
                  "Standard_D4a_v4",
                  "Standard_D8a_v4",
                  "Standard_D16a_v4",
                  "Standard_D32a_v4",
                  "Standard_D48a_v4",
                  "Standard_D64a_v4",
                  "Standard_D96a_v4",
                  "Standard_D4as_v4",
                  "Standard_D8as_v4",
                  "Standard_D16as_v4",
                  "Standard_D32as_v4",
                  "Standard_D48as_v4",
                  "Standard_D64as_v4",
                  "Standard_D96as_v4",
                  "Standard_D4_v5",
                  "Standard_D8_v5",
                  "Standard_D16_v5",
                  "Standard_D32_v5",
                  "Standard_D48_v5",
                  "Standard_D64_v5",
                  "Standard_D96_v5",
                  "Standard_D4s_v5",
                  "Standard_D8s_v5",
                  "Standard_D16s_v5",
                  "Standard_D32s_v5",
                  "Standard_D48s_v5",
                  "Standard_D64s_v5",
                  "Standard_D96s_v5"
                ],
                "constraints": {
                  "allowedValues": [
                    "Standard_DS4_v2",
                    "Standard_DS5_v2",
                    "Standard_D4_v3",
                    "Standard_D8_v3",
                    "Standard_D16_v3",
                    "Standard_D4a_v4",
                    "Standard_D8a_v4",
                    "Standard_D16a_v4",
                    "Standard_D32a_v4",
                    "Standard_D48a_v4",
                    "Standard_D64a_v4",
                    "Standard_D96a_v4",
                    "Standard_D4as_v4",
                    "Standard_D8as_v4",
                    "Standard_D16as_v4",
                    "Standard_D32as_v4",
                    "Standard_D48as_v4",
                    "Standard_D64as_v4",
                    "Standard_D96as_v4",
                    "Standard_D4_v5",
                    "Standard_D8_v5",
                    "Standard_D16_v5",
                    "Standard_D32_v5",
                    "Standard_D48_v5",
                    "Standard_D64_v5",
                    "Standard_D96_v5",
                    "Standard_D4s_v5",
                    "Standard_D8s_v5",
                    "Standard_D16s_v5",
                    "Standard_D32s_v5",
                    "Standard_D48s_v5",
                    "Standard_D64s_v5",
                    "Standard_D96s_v5"
                  ]
                },
                "options": {
                  "hideDiskTypeFilter": false
                },
                "osPlatform": "Linux",
                "imageReference": {
                  "publisher": "fortinet",
                  "offer": "fortinet-fortianalyzer",
                  "sku": "fortinet-fortianalyzer"
                },
                "count": 1,
                "visible": true
              }
            ]
          },
          {
            "name": "availabilityOptions",
            "type": "Microsoft.Common.Section",
            "label": "Availability Options",
            "elements": [
              {
                "name": "availabilityOptionsHeader",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "Deploy FortiGate VMs in an Availability Set or Availability Zones.",
                  "link": {
                    "label": "Learn more",
                    "uri": "https://github.com/fortinet/azure-templates/tree/main/FortiGate#sla"
                  }
                }
              },
              {
                "name": "availabilityOptions",
                "type": "Microsoft.Common.DropDown",
                "label": "Availability Option",
                "defaultValue": "Availability Zones",
                "toolTip": "Deploy FortiGate VMs in an Availability Set or Availability Zones.",
                "constraints": {
                  "required": false,
                  "allowedValues": [
                    {
                      "label": "Availability Set",
                      "value": "Availability Set"
                    },
                    {
                      "label": "Availability Zones",
                      "value": "Availability Zones"
                    }
                  ]
                },
                "visible": true
              },
              {
                "name": "availabilityOptionsFooter",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                  "icon": "Info",
                  "text": "If Availability Zones deployment is selected but the location does not support Availability Zones an Availability Set will be deployed. If Availability Zones deployment is selected and Availability Zones are available in the location, FortiGate A will be placed in Zone 1, FortiGate B will be placed in Zone 2",
                  "uri": "https://docs.microsoft.com/en-us/azure/availability-zones/az-overview"
                }
              }
            ]
          },
          {
            "name": "datadisk",
            "type": "Microsoft.Common.Section",
            "label": "Data Disk",
            "elements": [
              {
                "name": "vmDataDiskCount",
                "type": "Microsoft.Common.TextBox",
                "label": "Number of managed disks per data node",
                "defaultValue": "1",
                "toolTip": "Number of disks to attach to the FortiAnalyzer.",
                "constraints": {
                  "required": true,
                  "regex": "^([0-9]|1[0-5])$",
                  "validationMessage": "Value must be numeric and greater than or equal to 0"
                }
              },
              {
                "name": "vmDataDiskSize",
                "type": "Microsoft.Common.DropDown",
                "label": "Size of each managed disk",
                "visible": "[greater(steps('instance').datadisk.vmDataDiskCount, 0)]",
                "defaultValue": "1TiB",
                "toolTip": "The size of each data disk to attach to the FortiAnalyzer",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "32GiB",
                      "value": "32"
                    },
                    {
                      "label": "64GiB",
                      "value": "64"
                    },
                    {
                      "label": "128GiB",
                      "value": "128"
                    },
                    {
                      "label": "256GiB",
                      "value": "256"
                    },
                    {
                      "label": "512GiB",
                      "value": "512"
                    },
                    {
                      "label": "1TiB",
                      "value": "1024"
                    },
                    {
                      "label": "2TiB",
                      "value": "2048"
                    },
                    {
                      "label": "4TiB",
                      "value": "4096"
                    },
                    {
                      "label": "8TiB",
                      "value": "8192"
                    },
                    {
                      "label": "16TiB",
                      "value": "16384"
                    },
                    {
                      "label": "32TiB",
                      "value": "32768"
                    }
                  ]
                }
              },
              {
                "name": "diskType",
                "type": "Microsoft.Common.DropDown",
                "label": "Type of managed disks",
                "visible": "[greater(steps('instance').datadisk.vmDataDiskCount, 0)]",
                "defaultValue": "Default disks for instance type",
                "toolTip": "The storage type of managed disks. The default will be Premium disks for VMs that support Premium disks and Standard disks for those that do not.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "Default disks for instance type",
                      "value": "Default"
                    },
                    {
                      "label": "Standard SSD disks - LRS",
                      "value": "StandardSSD_LRS"
                    },
                    {
                      "label": "Standard SSD disks - ZRS",
                      "value": "StandardSSD_ZRS"
                    },
                    {
                      "label": "Premium SSD disks - LRS",
                      "value": "Premium_LRS"
                    },
                    {
                      "label": "Premium SSD disks - ZRS",
                      "value": "Premium_ZRS"
                    },
                    {
                      "label": "Standard HDD disks - LRS",
                      "value": "Standard_LRS"
                    }
                  ]
                }
              }
            ]
          },
          {
            "name": "fazLicense",
            "type": "Microsoft.Common.Section",
            "label": "FortiAnalyzer License",
            "elements": [
              {
                "name": "fazLicenseBYOLInfo",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "The Bring Your Own license file(s), retrieved from support.fortinet.com, can be uploaded here or uploaded after deployment."
                }
              },
              {
                "name": "fortiFlexCheck",
                "type": "Microsoft.Common.CheckBox",
                "label": "My organisation is using the FortiFlex subscription service.",
                "toolTip": "My organisation is using the FortiFlex subscription service.",
                "visible": true
              },
              {
                "name": "fazAcontent",
                "type": "Microsoft.Common.FileUpload",
                "label": "FortiAnalyzer A License",
                "toolTip": "Upload the license file for the primary FortiAnalyzer BYOL here.",
                "constraints": {
                  "required": false,
                  "accept": ".lic,.txt"
                },
                "options": {
                  "multiple": false,
                  "uploadMode": "file",
                  "openMode": "text",
                  "encoding": "UTF-8"
                },
                "visible": "[not(steps('instance').fazLicense.fortiFlexCheck)]"
              },
              {
                "name": "fazBcontent",
                "type": "Microsoft.Common.FileUpload",
                "label": "FortiAnalyzer B License",
                "toolTip": "Upload the license file for the secondary FortiAnalyzer BYOL here.",
                "constraints": {
                  "required": false,
                  "accept": ".lic,.txt"
                },
                "options": {
                  "multiple": false,
                  "uploadMode": "file",
                  "openMode": "text",
                  "encoding": "UTF-8"
                },
                "visible": "[not(steps('instance').fazLicense.fortiFlexCheck)]"
              },
              {
                "name": "fazAfortiflex",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiAnalyzer A FortiFlex",
                "defaultValue": "",
                "toolTip": "FortiAnalyzer A FortiFlex",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": "[steps('instance').fazLicense.fortiFlexCheck]"
              },
              {
                "name": "fazBfortiflex",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiAnalyzer B FortiFlex",
                "defaultValue": "",
                "toolTip": "FortiAnalyzer B FortiFlex",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": "[steps('instance').fazLicense.fortiFlexCheck]"
              },
              {
                "name": "fazAserial",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiAnalyzer A Serial Number",
                "defaultValue": "",
                "toolTip": "FortiAnalyzer A Serial Number",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": "true"
              },
              {
                "name": "fazBserial",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiAnalyzer B Serial Number",
                "defaultValue": "",
                "toolTip": "FortiAnalyzer B Serial Number",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": "true"
              }
            ]
          }
        ]
      },
      {
        "name": "networking",
        "label": "Networking",
        "subLabel": {
          "preValidation": "Configure internal networking",
          "postValidation": "Done"
        },
        "elements": [
          {
            "name": "options",
            "type": "Microsoft.Common.DropDown",
            "label": "Architecture options",
            "defaultValue": "VRRP automatic failover using a secondary private IP",
            "toolTip": "Deploy NAT Gateway or attach Public IP address for each FortiGate.",
            "constraints": {
              "required": false,
              "allowedValues": [
                {
                  "label": "Active-Active",
                  "value": "a-a"
                },
                {
                  "label": "VRRP automatic failover using a public IP attached to a secondary ipconfig",
                  "value": "a-p-external-vip"
                },
                {
                  "label": "VRRP automatic failover using a secondary private IP",
                  "value": "a-p-internal-vip"
                }
              ]
            },
            "visible": true
          },
          {
            "name": "virtualnetworksection",
            "type": "Microsoft.Common.Section",
            "label": "Configure Internal Networking",
            "elements": [
              {
                "name": "virtualnetworktext",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "Create a new or select an existing virtual network with the required subnets."
                }
              },
              {
                "name": "virtualnetwork",
                "type": "Microsoft.Network.VirtualNetworkCombo",
                "label": {
                  "virtualNetwork": "Virtual network",
                  "subnets": "Subnets"
                },
                "toolTip": {
                  "virtualNetwork": "Virtual Network for deployment of the FortiAnalyzer VM solution",
                  "subnets": "Standard deployment is to have an "
                },
                "defaultValue": {
                  "name": "[if(equals(basics('namePrefix'),''),'fortianalyzer-vnet',concat(basics('namePrefix'),'-vnet'))]",
                  "addressPrefixSize": "/24"
                },
                "constraints": {
                  "minAddressPrefixSize": "/29"
                },
                "options": {
                  "hideExisting": false
                },
                "subnets": {
                  "subnet1": {
                    "label": "FortiAnalyzer Subnet",
                    "defaultValue": {
                      "name": "fortianalyzersubnet",
                      "addressPrefixSize": "/26"
                    },
                    "constraints": {
                      "minAddressPrefixSize": "/29",
                      "minAddressCount": 4,
                      "requireContiguousAddresses": true
                    }
                  }
                },
                "visible": true
              },
              {
                "name": "virtualnetworkinfo",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                  "icon": "Info",
                  "text": "More information about the deployment can be found here.",
                  "uri": "https://github.com/fortinet/azure-templates/tree/main/FortiAnalyzer/single-1nic"
                }
              }
            ]
          }
        ]
      },
      {
        "name": "publicip",
        "label": "Public IP",
        "subLabel": {
          "preValidation": "Configure public networking",
          "postValidation": "Done"
        },
        "elements": [
          {
            "name": "publiciptext",
            "type": "Microsoft.Common.TextBlock",
            "visible": true,
            "options": {
              "text": "The public IP will be used for connect to the FortiAnalyzer. The public IP is optional. Selecting none will result in a FortiAnalyzer that is not accessible from the public internet. Other means like VPN connection or Experess Route are needed to connect to the unit in that case."
            }
          },
          {
            "name": "fazvippublicip",
            "type": "Microsoft.Network.PublicIpAddressCombo",
            "label": {
              "publicIpAddress": "FortiAnalyzer VIP Public IP",
              "domainNameLabel": "Domain name label"
            },
            "toolTip": {
              "publicIpAddress": "Public IP attached for FortiAnalyzer service",
              "domainNameLabel": "DNS name linked to this public IP"
            },
            "defaultValue": {
              "publicIpAddressName": "[if(equals(basics('namePrefix'),''),'faz-vip',concat(basics('namePrefix'),'-faz-vip'))]",
              "domainNameLabel": "mydomain"
            },
            "constraints": {
              "required": {
                "domainNameLabel": false
              }
            },
            "options": {
              "hideNone": false,
              "hideDomainNameLabel": true
            },
            "visible": "[equals(steps('networking').options, 'a-p-external-vip')]"
          },
          {
            "name": "fazamgmtpublicip",
            "type": "Microsoft.Network.PublicIpAddressCombo",
            "label": {
              "publicIpAddress": "FortiAnalyzer A management",
              "domainNameLabel": "Domain name label"
            },
            "toolTip": {
              "publicIpAddress": "Public IP attached to the FortiAnalyzer A for management",
              "domainNameLabel": "DNS name linked to this public IP"
            },
            "defaultValue": {
              "publicIpAddressName": "[if(equals(basics('namePrefix'),''),'faz-a-mgmt-pip',concat(basics('namePrefix'),'-faz-a-mgmt-pip'))]",
              "domainNameLabel": "mydomain"
            },
            "constraints": {
              "required": {
                "domainNameLabel": false
              }
            },
            "options": {
              "hideNone": false,
              "hideDomainNameLabel": true
            },
            "visible": true
          },
          {
            "name": "fazbmgmtpublicip",
            "type": "Microsoft.Network.PublicIpAddressCombo",
            "label": {
              "publicIpAddress": "FortiAnalyzer B management",
              "domainNameLabel": "Domain name label"
            },
            "toolTip": {
              "publicIpAddress": "Public IP attached to the FortiAnalyzer B for management",
              "domainNameLabel": "DNS name linked to this public IP"
            },
            "defaultValue": {
              "publicIpAddressName": "[if(equals(basics('namePrefix'),''),'faz-b-mgmt-pip',concat(basics('namePrefix'),'-faz-b-mgmt-pip'))]",
              "domainNameLabel": "mydomain"
            },
            "constraints": {
              "required": {
                "domainNameLabel": false
              }
            },
            "options": {
              "hideNone": false,
              "hideDomainNameLabel": true
            },
            "visible": true
          },
          {
            "name": "standardsku",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "This deployment can be deployed without public IPs but requires outbound access using a upstream FortiGate, NAT Gateway or other path to internet. Deployment with public IPs requires the standard SKU.",
              "uri": "https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-public-ip-address-upgrade?tabs=option-upgrade-cli%2Coption-migrate-powershell"
            }
          }
        ]
      },
      {
        "name": "publicipreview",
        "label": "Public IP Verification",
        "subLabel": {
          "preValidation": "Public IP SKU Review",
          "postValidation": "Done"
        },
        "bladeTitle": "Public IP SKU Review",
        "elements": [
          {
            "name": "BasicIPWarning1",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Error",
              "text": "The FortiAnalyzer VIP Public IP is configured using Basic SKU. Please return to previous blade and use Standard type public IPs"
            },
            "visible": "[and(equals(steps('networking').options, 'a-p-external-vip'),not(or(equals(steps('publicip').fazvippublicip.newOrExistingOrNone,'none'),equals(steps('publicip').fazvippublicip.sku, 'Standard'))))]"
          },
          {
            "name": "StandardIPConfirmation1",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "The FortiAnalyzer VIP Public IP is Standard SKU. Proceed."
            },
            "visible": "[equals(steps('publicip').fazvippublicip.sku, 'Standard')]"
          },
          {
            "name": "BasicIPWarning2",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Error",
              "text": "The FortiGate A management Public IP is configured using Basic SKU. Please return to previous blade and use Standard type public IPs"
            },
            "visible": "[not(or(equals(steps('publicip').fazamgmtpublicip.newOrExistingOrNone,'none'),equals(steps('publicip').fazamgmtpublicip.sku, 'Standard')))]"
          },
          {
            "name": "StandardIPConfirmation2",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "The FortiGate A management Public IP is Standard SKU or none selected. Proceed."
            },
            "visible": "[equals(steps('publicip').fazamgmtpublicip.sku, 'Standard')]"
          },
          {
            "name": "BasicIPWarning3",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Error",
              "text": "The FortiGate B management Public IP is configured using Basic SKU. Please return to previous blade and use Standard type public IPs"
            },
            "visible": "[not(or(equals(steps('publicip').fazbmgmtpublicip.newOrExistingOrNone,'none'),equals(steps('publicip').fazbmgmtpublicip.sku, 'Standard')))]"
          },
          {
            "name": "StandardIPConfirmation3",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "The FortiGate B management Public IP is Standard SKU or none selected. Proceed."
            },
            "visible": "[equals(steps('publicip').fazbmgmtpublicip.sku, 'Standard')]"
          }
        ]
      },
      {
        "name": "advanced",
        "label": "Advanced",
        "subLabel": {
          "preValidation": "Advanced options",
          "postValidation": "Done"
        },
        "elements": [
          {
            "name": "customdata",
            "type": "Microsoft.Common.Section",
            "label": "Custom Data",
            "elements": [
              {
                "name": "customdatatext",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "Pass a configuration file into the virtual machine while it is being provisioned. This is additional to the configuration for this architecture."
                }
              },
              {
                "name": "config",
                "type": "Microsoft.Common.TextBox",
                "label": "Custom Data",
                "toolTip": "Custom Data",
                "placeholder": "Add you required additional configuration here.",
                "multiLine": true,
                "constraints": {
                  "required": false,
                  "validations": [
                    {
                      "regex": "^[\\w\\W\n\t]{0,10240}$",
                      "message": "All characters allowed, max 10240 characters."
                    }
                  ]
                },
                "visible": true
              },
              {
                "name": "standardsku",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                  "icon": "Info",
                  "text": "The default configuration already included in this deployment can be found on our github page. ",
                  "uri": "https://github.com/fortinet/azure-templates/blob/main/FortiAnalyzer/single-1nic/doc/config-provisioning.md"
                }
              }
            ]
          },
          {
            "name": "serialconsole",
            "type": "Microsoft.Common.Section",
            "label": "Serial Console",
            "elements": [
              {
                "name": "enabled",
                "type": "Microsoft.Common.OptionsGroup",
                "label": "Enable Serial Console",
                "defaultValue": "yes",
                "toolTip": "Enables the serial console and creates a required storage account.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "yes",
                      "value": "yes"
                    },
                    {
                      "label": "no",
                      "value": "no"
                    }
                  ],
                  "required": true
                },
                "visible": true
              },
              {
                "name": "standardsku",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                  "icon": "Info",
                  "text": "This requires a storage account which will be created during deployment.",
                  "uri": "https://docs.microsoft.com/en-us/troubleshoot/azure/virtual-machines/serial-console-overview"
                }
              }
            ]
          }
        ]
      }
    ],
    "outputs": {
      "namePrefix": "[basics('namePrefix')]",
      "imageSku": "[basics('imageSku')]",
      "imageVersion": "[basics('imageVersion')]",
      "adminUsername": "[basics('adminUsername')]",
      "adminPassword": "[basics('adminPassword')]",
      "location": "[location()]",
      "instanceType": "[steps('instance').instancetype.selection]",
      "availabilityOptions": "[steps('instance').availabilityOptions.availabilityOptions]",
      "dataDiskCount": "[int(steps('instance').datadisk.vmDataDiskCount)]",
      "dataDiskSize": "[steps('instance').datadisk.vmDataDiskSize]",
      "diskType": "[steps('instance').datadisk.diskType]",
      "fortiAnalyzerALicenseBYOL": "[steps('instance').fazLicense.fazAcontent]",
      "fortiAnalyzerBLicenseBYOL": "[steps('instance').fazLicense.fazBcontent]",
      "fortiAnalyzerALicenseFortiFlex": "[steps('instance').fazLicense.fazAfortiflex]",
      "fortiAnalyzerBLicenseFortiFlex": "[steps('instance').fazLicense.fazBfortiflex]",
      "fortiAnalyzerSerialNumberA": "[steps('instance').fazLicense.fazAserial]",
      "fortiAnalyzerSerialNumberB": "[steps('instance').fazLicense.fazBserial]",
      "highavailabilityMethod": "[steps('networking').options]",
      "publicIP1NewOrExisting": "[steps('publicip').fazvippublicip.newOrExistingOrNone]",
      "publicIP1Name": "[steps('publicip').fazvippublicip.name]",
      "publicIP1ResourceGroup": "[steps('publicip').fazvippublicip.resourceGroup]",
      "publicIP2NewOrExisting": "[steps('publicip').fazamgmtpublicip.newOrExistingOrNone]",
      "publicIP2Name": "[steps('publicip').fazamgmtpublicip.name]",
      "publicIP2ResourceGroup": "[steps('publicip').fazamgmtpublicip.resourceGroup]",
      "publicIP3NewOrExisting": "[steps('publicip').fazbmgmtpublicip.newOrExistingOrNone]",
      "publicIP3Name": "[steps('publicip').fazbmgmtpublicip.name]",
      "publicIP3ResourceGroup": "[steps('publicip').fazbmgmtpublicip.resourceGroup]",
      "vnetNewOrExisting": "[steps('networking').virtualnetworksection.virtualnetwork.newOrExisting]",
      "vnetName": "[steps('networking').virtualnetworksection.virtualnetwork.name]",
      "vnetResourceGroup": "[steps('networking').virtualnetworksection.virtualnetwork.resourceGroup]",
      "vnetAddressPrefix": "[steps('networking').virtualnetworksection.virtualnetwork.addressPrefix]",
      "subnet1Name": "[steps('networking').virtualnetworksection.virtualnetwork.subnets.subnet1.name]",
      "subnet1Prefix": "[steps('networking').virtualnetworksection.virtualnetwork.subnets.subnet1.addressPrefix]",
      "subnet1StartAddress": "[steps('networking').virtualnetworksection.virtualnetwork.subnets.subnet1.startAddress]",
      "serialConsole": "[steps('advanced').serialconsole.enabled]",
      "additionalCustomData": "[steps('advanced').customdata.config]"
    }
  }
}
